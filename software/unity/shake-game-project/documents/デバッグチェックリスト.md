# ノートが流れてこない場合のチェックリスト

## 1. シーン構成の確認

### GameManagerV2
- [ ] シーンに配置されている
- [ ] Enterキーを2回押してゲームを開始している（IdleRegister → IdleStarting → Game）

### ChartManagerV2
- [ ] シーンに配置されている
- [ ] Chart Json フィールドに bgm2.json がアタッチされている
- [ ] Consoleに「譜面読み込み完了」のログが表示される

### NotePoolV2
- [ ] シーンに配置されている
- [ ] Note Prefab フィールドにプレファブがアタッチされている
- [ ] Initial Pool Size が 50 以上

### LongNotePoolV2（長押しノート使用時）
- [ ] シーンに配置されている
- [ ] Long Note Prefab フィールドにプレファブがアタッチされている
- [ ] Initial Pool Size が 10 以上

### NoteSpawnerV2
- [ ] シーンに配置されている
- [ ] Center Point フィールドに中心位置のTransformがアタッチされている
- [ ] Device Icons 配列（サイズ10）に各アイコンのTransformがアタッチされている
- [ ] Device Note Sprites 配列にスプライトがアタッチされている（なくてもエラーは出ないが見えない）
- [ ] Spawn Ahead Time が 2.0 程度

### VideoManager
- [ ] シーンに配置されている
- [ ] VideoPlayerコンポーネントがアタッチされている
- [ ] ゲーム開始時に動画が再生される

---

## 2. Consoleログの確認

ゲーム実行時に以下のログが表示されるか確認：

```
[ChartManagerV2] 譜面読み込み完了: background - コピー, XXノーツ
[ChartDataV2] 変換完了: XXノーツ（BPM=175, offset=1.150秒）
[ChartDataV2] 最初のノート: time=1.150秒, deviceId=0, type=Single
[NotePoolV2] プール初期化完了: 50個
[LongNotePoolV2] プール初期化完了: 10個
[GameManagerV2] State changed to Game
[NoteSpawnerV2] ノーツ生成開始 - 総ノート数: XX
[NoteSpawnerV2] Spawning note: index=0, time=1.150s, deviceId=0, type=Single, currentTime=0.000s
```

---

## 3. よくある問題

### A. ノートが全く生成されない
- ChartManagerV2にJSONがアタッチされていない
- ゲームが開始されていない（Enterキーを2回押す）
- VideoManagerが存在しない（GetMusicTime()がエラー）

### B. ノートが見えない
- プレファブにSpriteRendererがない
- スプライトが設定されていない
- Z座標が背景より奥にある
- カメラの範囲外に配置されている
- centerPointやdeviceIconsの位置が不正

### C. タイミングがずれる
- offsetの単位が間違っている（修正済み: 1/10000秒単位）
- VideoManagerの再生開始タイミングがずれている
- spawnAheadTimeが大きすぎる/小さすぎる

### D. 長押しノートだけ出ない
- LongNotePoolV2が配置されていない
- 長押しプレファブが設定されていない

---

## 4. デバッグ方法

### 手動でノートを生成してテスト
NoteSpawnerV2のStart()に以下を追加：

```csharp
void Start()
{
    // 既存のコード...
    
    // テスト用: 3秒後に手動でノートを1個生成
    StartCoroutine(TestSpawnNote());
}

private IEnumerator TestSpawnNote()
{
    yield return new WaitForSeconds(3f);
    
    if (NotePoolV2.Instance != null && centerPoint != null && deviceIcons.Length > 0)
    {
        var testNote = new ChartDataV2.GameNote(0, 5f, ChartDataV2.NoteType.Single);
        SpawnSingleNote(testNote, centerPoint.position, deviceIcons[0].position);
        Debug.Log("[NoteSpawnerV2] テストノート生成！");
    }
}
```

これで3秒後にノートが1個流れるはずです。

---

## 5. 推奨デバッグ順序

1. Consoleログで「譜面読み込み完了」を確認
2. Enterキーを2回押して「State changed to Game」を確認
3. 「ノーツ生成開始」ログを確認
4. 「Spawning note」ログが出るか確認
5. Scene ViewでノートオブジェクトがPoolの下に生成されているか確認
6. 生成されたノートのTransformの位置を確認

ログを貼っていただければ、さらに詳しく診断できます！
