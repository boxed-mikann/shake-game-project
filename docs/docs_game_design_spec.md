# シェイクゲーム ゲームデザイン仕様書

## 概要

複数のプレイヤーが子機（ESP32+MPU6050）を振ることで、ゲージを増加・減少させ、対戦するマルチプレイゲーム。

## ゲームフロー

```
┌─────────────────┐
│   ゲーム開始    │ ← Processing起動、各子機が親機に接続
└────────┬────────┘
         │
         ▼
┌─────────────────────────────┐
│  フェーズ1: チャージフェーズ  │
│  (10秒間)                   │
│  ・シェイク → ゲージ増加      │
│  ・画面表示「フェーズ1開始」  │
│  ・効果音「チャージ音」       │
└────────┬────────────────────┘
         │ (10秒経過)
         ▼
┌─────────────────────────────┐
│  フェーズ2: 抵抗フェーズ      │
│  (10秒間)                   │
│  ・シェイク → ゲージ減少      │
│  ・画面表示「シェイク禁止！」 │
│  ・ペナルティ音              │
└────────┬────────────────────┘
         │ (10秒経過)
         ▼
┌──────────────┐
│ ゲージ確認   │
└────┬─────┬──┘
     │     │
  ゴール達成  ゴール未達成
     │       │
     ▼       ▼
 ┌────┐   ┌──────┐
 │勝利│   │フェーズ1へ
 │動画│   │ループ
 └────┘   └──────┘
```

## ゲーム要素

### 1. ゲージシステム

#### Team Gauge（2チーム対戦）

```
Team A: ▓▓▓▓░░░░░░  (40%)
Team B: ▓▓▓▓▓▓░░░░  (60%)
```

**仕様:**
- **初期値:** 各チーム 0%
- **ゴール値:** 100%
- **増加量:** シェイク時の加速度に比例
  ```
  ゲージ増加 = (加速度 - 5000) / 10000 × 5%
  ```
- **減少量:** シェイク時の加速度に比例（抵抗フェーズ）
  ```
  ゲージ減少 = (加速度 - 5000) / 10000 × 3%
  ```

**ゲージの見た目:**
- 半透明（透明度 50%）
- 背景にプレイ動画が表示される
- 縦方向に積み上がる棒グラフ

### 2. フェーズシステム

#### フェーズ1: チャージフェーズ（加算）

**時間:** 10秒  
**条件:** シェイク時にゲージ増加  
**画面表示:**
```
┌────────────────────────┐
│   フェーズ1: チャージ！  │
│  どんどん振ってください  │
│                        │
│   あと 7.2 秒          │
│                        │
│ Team A: ▓▓▓░░░░░░░░  │
│ Team B: ▓▓▓▓░░░░░░░  │
└────────────────────────┘
```

**効果音:** 
- シェイク検知: 「ポン」（短い効果音）
- フェーズ終了: 「ピン」（通知音）

#### フェーズ2: 抵抗フェーズ（減算）

**時間:** 10秒  
**条件:** シェイク時にゲージ減少 → ペナルティ  
**画面表示:**
```
┌────────────────────────┐
│  ⚠️ 振るな危険! ⚠️     │
│  シェイクすると減少!    │
│                        │
│   あと 8.5 秒          │
│                        │
│ Team A: ▓▓░░░░░░░░░  │
│ Team B: ▓▓▓░░░░░░░░  │
└────────────────────────┘
```

**効果音:**
- シェイク検知: 「ブッ」（警告音）
- ゲージ減少時: 「シュー」（減少音）

### 3. 勝利条件

**ゴール値到達時:**
```
Team A が 100% に到達
  ↓
画面表示: 「TEAM A WIN!」
  ↓
勝利動画再生（5秒間）
  ↓
ゲーム終了または再スタート
```

### 4. チーム分け

**子機の割り当て:**
```
子機0-9:   Team A（赤色）
子機10-19: Team B（青色）
```

**ゲージ合算:**
```
Team A ゲージ = Σ(子機0-9のシェイク) / 10
Team B ゲージ = Σ(子機10-19のシェイク) / 10
```

## 技術仕様

### Processing側の通信形式

**親機からの受信データ（50ms間隔）:**
```
Format: childID,shakeCount,acceleration,acX,acY,acZ

例:
0,5,8234.5,4000,5000,-2000
1,3,6500.2,3000,4000,-1500
```

### ゲージ計算ロジック

```processing
void updateGauge(int childID, float acceleration) {
  int teamID = childID < 10 ? 0 : 1;  // Team A=0, Team B=1
  
  if (currentPhase == PHASE_CHARGE) {
    // チャージフェーズ: 加算
    float increase = (acceleration - ACCEL_THRESHOLD) / 10000.0 * 5.0;
    teamGauge[teamID] += max(0, increase);
    
    // 効果音再生
    playSound("charge.wav");
    
  } else if (currentPhase == PHASE_RESIST) {
    // 抵抗フェーズ: 減算
    float decrease = (acceleration - ACCEL_THRESHOLD) / 10000.0 * 3.0;
    teamGauge[teamID] -= max(0, decrease);
    
    // ペナルティ音再生
    playSound("penalty.wav");
  }
  
  // ゲージ上限チェック
  teamGauge[teamID] = constrain(teamGauge[teamID], 0, 100);
}
```

### 画面レイアウト

```
┌──────────────────────────────────────┐
│  フェーズ表示領域 (半透明オーバーレイ) │
│  ┌──────────────────────────────────┐│
│  │ フェーズ 1: チャージ!            ││
│  │ あと 7.2 秒                     ││
│  └──────────────────────────────────┘│
│                                      │
│ ← ゲーム動画背景（半透明ゲージの背後）│
│                                      │
│ ┌──────────────────────────────────┐ │
│ │Team A: ▓▓▓░░░░░░░░  45%        │ │
│ │Team B: ▓▓▓▓▓░░░░░░  50%        │ │
│ └──────────────────────────────────┘ │
│                                      │
│ ┌──────────────────────────────────┐ │
│ │各プレイヤーの詳細（グリッド表示）│ │
│ │Player #0: Count=5  Accel=8234   │ │
│ │Player #1: Count=3  Accel=6500   │ │
│ └──────────────────────────────────┘ │
└──────────────────────────────────────┘
```

### 状態管理

```processing
// ゲーム状態
final int STATE_IDLE = 0;
final int STATE_PLAYING = 1;
final int STATE_WIN = 2;

// フェーズ状態
final int PHASE_CHARGE = 1;
final int PHASE_RESIST = 2;

// グローバル変数
int gameState = STATE_IDLE;
int currentPhase = PHASE_CHARGE;
float phaseStartTime = 0;
float phaseDuration = 10000;  // 10秒
float[] teamGauge = {0, 0};   // Team A, Team B
```

## 実装ロードマップ

### Phase 1: 基本ゲーム (今週)
- ✅ 2フェーズの切り替え
- ✅ ゲージ増減ロジック
- ✅ 基本UI表示

### Phase 2: オーディオ・ビジュアル (来週)
- ⏳ 効果音実装
- ⏳ 背景動画再生
- ⏳ 勝利画面

### Phase 3: ポーランド (2週間後)
- ⏳ UIアニメーション
- ⏳ パーティクル効果
- ⏳ ゲームバランス調整

## パラメータ一覧

| パラメータ | 値 | 説明 |
|-----------|-----|------|
| **PHASE_DURATION** | 10000ms | 各フェーズの時間 |
| **ACCEL_THRESHOLD** | 5000 | ゲージ増加の加速度閾値 |
| **GAUGE_INCREASE_RATE** | 5% | チャージ時のゲージ増加率 |
| **GAUGE_DECREASE_RATE** | 3% | 抵抗時のゲージ減少率 |
| **GOAL_GAUGE** | 100% | 勝利条件のゲージ値 |
| **TEAM_A_CHILD_RANGE** | 0-9 | Team A の子機ID範囲 |
| **TEAM_B_CHILD_RANGE** | 10-19 | Team B の子機ID範囲 |

## 今後の拡張案

### ゲームモード追加
- **クイックゲーム:** フェーズ短縮（各5秒）
- **マラソンモード:** ゲージ量増加（200%）
- **タイムアタック:** ゴール到達の時間を競う

### 難易度調整
- **Easy:** ゲージ増加50%アップ
- **Normal:** デフォルト
- **Hard:** ゲージ増加50%ダウン

### ビジュアル改善
- LEDライトの点灯（外部ハードウェア）
- スマートフォンの振動フィードバック
- AR表現の検討