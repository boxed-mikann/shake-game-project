# シェイクゲーム開発日誌(AI生成)

## プロジェクト概要

Arduino ESP32 + 複数子機による **マルチプレイヤーシェイクゲーム**

- **プレイヤー数**: 最大20人（2チーム対戦）
- **目的**: 加速度センサーでシェイク検知 → ゲージを競う

---

## Phase 1: Processing での実装（2025年10月-11月上旬）

### 達成事項 ✅

#### 1. ジャーク検知アルゴリズム実装
- **従来版**: 加速度が閾値を超える（誤検知多い）
- **改善版**: ジャーク（加速度の変化率）を検知
**参考**: `docs/shake_detection_algorithm.md`

#### 2. ゲーム基本ロジック完成
- 2フェーズシステム（チャージ・抵抗フェーズ）
- ゲージ計算: `Accel × 0.005`
- 2チーム対戦、100%達成で勝利
- フェーズ自動切り替え（10秒ごと）

#### 3. UI・効果音実装
- メイリオフォントで日本語対応
- ゲージ表示（左右対称）
- 効果音3種類（Minim ライブラリ）
  - コイン音（600Hz→1000Hz）
  - ペナルティ音（800Hz→400Hz）
  - 勝利音（800Hz→1000Hz→1200Hz）

#### 4. 動画再生機能実装
- `processing.video` ライブラリで動画再生
- プレイ中背景動画
- 勝利時動画表示

### 課題と限界 ❌

#### 課題1: 動画再生がカクカク
```
現象: 30-40fps、フレーム飛び多い
原因: Processing の GStreamer ベース動画処理
  → Java VM のオーバーヘッド
  → フレームバッファの非同期処理
(AI曰く)
結論: Processing の設計上の限界
```

#### 課題2: 音楽・映像の同期ができない
```
必要性: 後段でリズムゲーム化を検討
  → 「ビート時にシェイク」などの同期が必須

Processing の制限:(AI曰く)
  - AudioSource の再生位置取得が不正確（±50-100ms）
  - VideoPlayer のフレーム同期が弱い
  - リアルタイムオーディオ生成と映像の同期困難
```

#### 課題3: 複数デバイス対応の拡張性
```
現状: 1台でのみの検証

今後の懸念:
  - UI が複雑化したとき処理が落ちる可能性
  - マルチスレッド処理が限定的
  - ゲーム状態管理が冗長になりがち
```

---

## 技術選択の分析

### Processing での実装の評価(AI曰く)

| 観点 | 評価 | コメント |
|------|------|---------|
| **学習の容易さ** | ⭐⭐⭐⭐⭐ | プロトタイプに最適 |
| **Serial 通信実装** | ⭐⭐⭐⭐ | 簡単（built-in） |
| **動画再生** | ⭐⭐ | **ラグが致命的** |
| **音声同期** | ⭐ | **不可能に近い**(AI曰く) |
| **UI 構築** | ⭐⭐⭐ | 基本は OK だが複雑化難 |
| **マルチスレッド** | ⭐⭐ | 限定的 |

---

## 代替ツール検討

### 各ツールの比較表

```
┌─────────┬──────────┬──────────┬──────────┬──────────┐
│ ツール  │ 動画再生 │ 音声同期 │ 学習曲線 │ 推奨度  │
├─────────┼──────────┼──────────┼──────────┼──────────┤
│Processing│ △(遅い) │ ×(不可) │ ★☆☆   │ △(限定的) │
│VVVV    │ ○(まあまあ)│ ○(良い) │ ★★★   │ △(実験的) │
│Unity   │ ◎(優秀) │ ◎(優秀) │ ★★    │ ◎(推奨)  │
│Godot   │ ◎(優秀) │ ◎(優秀) │ ★★    │ ◎(代替案) │
└─────────┴──────────┴──────────┴──────────┴──────────┘
```

### 詳細分析

#### 1. VVVV v4（ビジュアルプログラミング）

**特徴**:
- ノードベースのビジュアルプログラミング
- リアルタイムプレビュー
- 複数入力デバイス対応が優秀

**向き**: 
- ✅ 展示・インスタレーション
- ✅ リアルタイムビジュアル制御
- ❌ 本格ゲーム開発

**判定**: △ 不適切

---

#### 2. Unity（ゲームエンジン）⭐ **推奨**

**特徴**:
```
動画再生:        60fps スムーズ
音声同期:        ±5-10ms（実用的）
マルチスレッド:  優秀
ネットワーク:    複数デバイス対応容易
拡張性:          非常に高い
ドキュメント:    豊富（日本語も充実）
```

**コード例**:
```csharp
// Serial 通信（Processing と同様）
SerialPort serialPort = new SerialPort("COM3", 115200);
serialPort.Open();

// 音楽・動画同期
audioSource.Play();
videoPlayer.Play();
videoPlayer.time = audioSource.time;  // ← 同期！

// ゲージ更新
if (audioSource.isPlaying) {
    UpdateGauges();
}
```

**学習期間**: 
- Unity 基本: 3-5 日
- Serial 通信実装: 1-2 日
- ゲーム ロジック移植: 3-5 日
- **合計: 1-2 週間で本格化**

**判定**: ◎ **強く推奨**

---

#### 3. Godot（軽量ゲームエンジン）

**特徴**:
- 完全オープンソース
- 軽量・高速
- GDScript が学びやすい

**判定**: ◎ 代替案（Unity より学習時間短い）

---

## 推奨: Unity への移行

### 移行理由

1. **音楽・映像同期が必須** ← 今後の拡張で必要
2. **複数デバイス対応** ← マルチスレッド処理に優れてる
3. **本格的ゲーム開発に適する**
4. **業界標準** ← 参考資料・コミュニティが豊富
5. **ドキュメント日本語化が進んでる**

### 想定ラグ改善

| 項目 | Processing | Unity | 改善度 |
|------|-----------|-------|--------|
| 動画FPS | 30-40fps | 58-60fps | **+20-30fps** |
| 音声ズレ | ±50-100ms | ±5-10ms | **80-90%削減** |
| 入力遅延 | 50-100ms | 5-20ms | **70%削減** |

---

## 次のステップ

### Phase 2: Unity での実装（予定）

#### 準備（1-2 日）
```bash
1. Unity Hub インストール
2. Unity 2022 LTS インストール
3. 新規 2D プロジェクト作成
4. 基本チュートリアル実施
```

#### 実装
```
Step 1: Serial 通信実装
Step 2: ゲージ表示・ゲーム ロジック
Step 3: 音楽・動画再生 + 同期
Step 4: UI・効果音
```

#### リポジトリ構成
```
shake-game-project/
├── firmware/          （変更なし）
├── software/
│   ├── processing/   （保存・参考用）
│   └── unity/        （★ 新規）
│       ├── Assets/
│       ├── Packages/
│       └── ProjectSettings/
└── docs/
    ├── shake_detection_algorithm.md
    ├── SOFTWARE_DEVELOPMENT_JOURNEY.md      （このファイル）
    ├── TOOL_COMPARISON.md
    └── MIGRATION_GUIDE.md
```

---

## 結論

| 項目 | 結論 |
|------|------|
| **Processing での実装** | ✅ **成功**（プロトタイプとして有効） |
| **今後の推奨** | ⭐ **Unity への移行** |
| **理由** | 音楽・映像同期 + ラグ削減が必須 |
| **期間** | 2-3 週間で本格化 |

---

## 参考資料

- [Processing 公式](https://processing.org/)
- [Unity 公式](https://unity.com/)
- [Godot 公式](https://godotengine.org/)
- [このプロジェクトの shake_detection_algorithm.md](../shake_detection_algorithm.md)

---

**作成日**: 2025-11-03  
**更新日**: 2025-11-03  
**著者**: GithubCopilot(Claude Haiku 4.5) (boxed-mikann)