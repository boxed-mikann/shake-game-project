# 📋 シェイクゲームプロジェクト開発履歴

**統合日:** 2025-11-08  
**作成者:** @boxed-mikann (Github Copilot)  
**プロジェクト:** Arduino ESP32 を使ったマルチプレイシェイクゲーム

---

## 📅 タイムライン概要

```
2025-10月中旬～11月初旬: Phase 1: Processing での実装 ✅ 完了
2025-11月上旬～:          Phase 2: Unity 2D 試験版 ⏳ 進行中
2025-11月08日～:          Phase 3: Unity 3D 本体版 🚀 開始予定
```

---

## 🔄 [2025-11-08] LED制御機能と Unity 3D 移行準備

### LED制御機能の実装 ✅

**実装内容：**
- 子機のハードウェアにLEDを追加（GPIO 13）
- フリフリ検知時にLEDが自動点灯する機能を実装
- フリフリ終了（加速度が30000未満に低度）時にLED消灯

**修正内容：**
1. `child_device.ino` に以下を追加：
   - `const int LED_PIN = 13;` - LED制御用のピン定義
   - `pinMode(LED_PIN, OUTPUT);` - setup()内でLED初期化
   - `digitalWrite(LED_PIN, HIGH);` - フリフリ検知時に点灯
   - `digitalWrite(LED_PIN, LOW);` - フリフリ終了時に消灯

2. I2C通信設定の改善：
   - ピン設定を `Wire.begin(23, 22);` に更新（SDA: GPIO 23, SCL: GPIO 22）
   - I2Cクロック速度を400kHzに設定：`Wire.setClock(400000);`

**配線図参照:**
```
子機（ESP32 + MPU-6050）
├─ GPIO 23 (SDA) ─→ MPU-6050 SDA
├─ GPIO 22 (SCL) ─→ MPU-6050 SCL
├─ GPIO 13 ─────→ LEDライト ✨ NEW
├─ GND ─────────→ MPU-6050 GND
└─ 3.3V ────────→ MPU-6050 VCC
```

---

## Phase 1: Processing での実装（2025年10月-11月上旬） ✅ 完了

### 達成事項 ✅

#### 1. ジャーク検知アルゴリズム実装
- **従来版**: 加速度が閾値を超える（誤検知多い）
- **改善版**: ジャーク（加速度の変化率）を検知
- **参考**: `docs/shake_detection_algorithm.md`

#### 2. ゲーム基本ロジック完成
- 2フェーズシステム（チャージ・抵抗フェーズ）
- ゲージ計算: `Accel × 0.005`
- 2チーム対戦、100%達成で勝利
- フェーズ自動切り替え（10秒ごと）

#### 3. UI・効果音実装
- メイリオフォントで日本語対応
- ゲージ表示（左右対称）
- 効果音3種類（Minim ライブラリ）
  - コイン音（600Hz→1000Hz）
  - ペナルティ音（800Hz→400Hz）
  - 勝利音（800Hz→1000Hz→1200Hz）

#### 4. 動画再生機能実装
- `processing.video` ライブラリで動画再生
- プレイ中背景動画
- 勝利時動画表示

### Processing 実装の課題と限界 ❌

#### 課題1: 動画再生がカクカク ❌
```
現象: 30-40fps、フレーム飛び多い
原因: Processing の GStreamer ベース動画処理
  → Java VM のオーバーヘッド
  → フレームバッファの非同期処理
結論: Processing の設計上の限界
```

#### 課題2: 音楽・映像の同期ができない ❌
```
必要性: 後段でリズムゲーム化を検討
  → 「ビート時にシェイク」などの同期が必須

Processing の制限:
  - AudioSource の再生位置取得が不正確（±50-100ms）
  - VideoPlayer のフレーム同期が弱い
  - リアルタイムオーディオ生成と映像の同期困難
```

#### 課題3: 複数デバイス対応の拡張性 ❌
```
現状: 1台でのみの検証

今後の懸念:
  - UI が複雑化したとき処理が落ちる可能性
  - マルチスレッド処理が限定的
  - ゲーム状態管理が冗長になりがち
```

### Processing での実装の評価

| 観点 | 評価 | コメント |
|------|------|---------|
| **学習の容易さ** | ⭐⭐⭐⭐⭐ | プロトタイプに最適 |
| **Serial 通信実装** | ⭐⭐⭐⭐ | 簡単（built-in） |
| **動画再生** | ⭐⭐ | **ラグが致命的** |
| **音声同期** | ⭐ | **不可能に近い** |
| **UI 構築** | ⭐⭐⭐ | 基本は OK だが複雑化難 |
| **マルチスレッド** | ⭐⭐ | 限定的 |

---

## 代替ツール検討

### 各ツールの比較表

```
┌─────────┬──────────┬──────────┬──────────┬──────────┐
│ ツール  │ 動画再生 │ 音声同期 │ 学習曲線 │ 推奨度   │
├─────────┼──────────┼──────────┼──────────┼──────────┤
│Processing│ △(遅い) │ ×(不可) │ ★☆☆   │ △(限定的) │
│VVVV    │ ○(まあまあ)│ ○(良い) │ ★★★   │ △(実験的) │
│Unity   │ ◎(優秀) │ ◎(優秀) │ ★★    │ ◎(推奨)   │
└─────────┴──────────┴──────────┴──────────┴──────────┘
```

**結論: Unity が最適**

---

## Phase 2: Unity 2D 試験版（2025年11月上旬～） ⏳ 進行中

### 目的
- Processing の実装を C# に移植
- 2D での動作確認（UI、通信、ゲームロジック）

### 現状
- ✅ 基本プロジェクト構成完成
- ✅ Serial 通信実装
- ✅ 2チーム対戦ゲームロジック実装
- ⏳ UI 改善中
- ⏳ 効果音・SE 実装予定

### 位置
`software/unity/shake-game-project/` - 既存プロジェクト

---

## Phase 3: Unity 3D 本体版（2025年11月08日～） 🚀 開始予定

### 目的
- 3D グラフィックスでのゲーム実装
- Processing 2D 版の機能を 3D 化
- リズムゲーム化への拡張性確保

### 計画内容

#### 3D ビジュアル
- プレイヤーキャラクターの 3D モデル表示
- ゲージを 3D 表現
- 勝利シーン、敗北シーン の 3D アニメーション

#### リズムゲーム化の基盤構築
- AudioSource からの周波数解析
- ビート検出ロジック
- ビート時の UI/VFX フィードバック

#### 複数プレイヤー対応の UI
- スコアボード（複数人分表示）
- プレイヤー識別（チーム色表示など）

### 位置
`software/unity/shake-game-3d/` - 新規プロジェクト（予定）

### スケジュール
- 11月08日～: 基本プロジェクト構築
- 11月中旬: 3D モデル・シーン構築
- 11月下旬: ゲームロジック統合
- 12月上旬: テスト・調整

---

## 📚 関連ドキュメント

### 技術的詳細
- `shake_detection_algorithm.md` - ジャーク検知アルゴリズムの詳細
- `acceralation_tuning_guide.md` - 加速度センサー値チューニング
- `system_design.md` - 全体システム設計

### ハードウェア関連
- `../hardware/wiring_diagram.md` - 配線図（子機LED対応版）
- `../hardware/BOM.md` - 部品リスト

### セットアップ
- `SETUP.md` - 開発環境セットアップガイド（旧: setup_guid.md）

### トラブルシューティング
- `troubleshooting.md` - よくある問題と解決方法

---

## 🎯 今後のマイルストーン

- ✅ LED 制御機能実装（2025-11-08 完了）
- 🚀 Unity 3D プロジェクト開始（2025-11-08～）
- ⏳ 3D ビジュアル実装（予定: 11月中旬）
- ⏳ リズムゲーム化検討（予定: 11月下旬～12月）

---

## 📝 メモ

### AI生成ドキュメントについて

本ドキュメント及び関連ファイルは、多くの部分で AI（GitHub Copilot）が生成しています。

⚠️ **注意:** 未検証事項が含まれている可能性があります。
- ジャーク検知アルゴリズムの効果に関する記述
- Processing の技術的制限についての説明
- 推定される性能値（フレームレート、同期精度など）

これらについては、実装・テストを通じて適宜検証・更新してください。

---

## 更新履歴

| 日付 | 作業内容 | ステータス |
|------|---------|----------|
| 2025-11-08 | 開発履歴の統合、LED機能実装 | ✅ 完了 |
| 2025-11-03 | Phase 1 Processing 実装完了 | ✅ 完了 |
